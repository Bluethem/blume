<div class="min-h-screen bg-gray-50 dark:bg-gray-900">
  <!-- Loading State -->
  <div *ngIf="loading" class="flex justify-center items-center min-h-screen">
    <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-primary"></div>
  </div>

  <!-- Content -->
  <div *ngIf="!loading" class="px-4 md:px-10 lg:px-20 flex flex-1 justify-center py-5">
    <div class="flex flex-col max-w-[960px] flex-1">
      
      <!-- Header -->
      <div class="flex flex-wrap justify-between gap-4 p-4">
        <div class="flex min-w-72 flex-col gap-2">
          <h1 class="text-4xl font-black leading-tight tracking-tighter text-gray-900 dark:text-white">
            Notificaciones
          </h1>
          <p *ngIf="totalNoLeidas > 0" class="text-sm text-gray-600 dark:text-gray-400">
            Tienes {{ totalNoLeidas }} notificación{{ totalNoLeidas !== 1 ? 'es' : '' }} sin leer
          </p>
        </div>
        <button (click)="marcarTodasComoLeidas()"
                *ngIf="totalNoLeidas > 0"
                class="flex min-w-[84px] items-center justify-center gap-2 overflow-hidden rounded-lg h-10 px-4 bg-primary/20 text-primary text-sm font-bold leading-normal tracking-wide hover:bg-primary/30 transition-colors">
          <span class="material-symbols-outlined text-lg">done_all</span>
          <span class="truncate">Marcar todas como leídas</span>
        </button>
      </div>

      <!-- Filters -->
      <div class="flex px-4 py-3">
        <div class="flex h-10 w-full items-center justify-center rounded-lg bg-gray-200 dark:bg-gray-800 p-1">
          <label class="flex cursor-pointer h-full grow items-center justify-center overflow-hidden rounded-lg px-2 transition-all"
                 [class.bg-white]="filtroActivo === 'todas'"
                 [class.dark:bg-gray-900]="filtroActivo === 'todas'"
                 [class.shadow-md]="filtroActivo === 'todas'"
                 [class.text-primary]="filtroActivo === 'todas'"
                 [class.text-gray-600]="filtroActivo !== 'todas'"
                 [class.dark:text-gray-400]="filtroActivo !== 'todas'">
            <span class="truncate text-sm font-medium leading-normal">Todas</span>
            <input (change)="cambiarFiltro('todas')"
                   [checked]="filtroActivo === 'todas'"
                   class="invisible w-0"
                   name="notification_filter"
                   type="radio"
                   value="todas"/>
          </label>
          <label class="flex cursor-pointer h-full grow items-center justify-center overflow-hidden rounded-lg px-2 transition-all"
                 [class.bg-white]="filtroActivo === 'no_leidas'"
                 [class.dark:bg-gray-900]="filtroActivo === 'no_leidas'"
                 [class.shadow-md]="filtroActivo === 'no_leidas'"
                 [class.text-primary]="filtroActivo === 'no_leidas'"
                 [class.text-gray-600]="filtroActivo !== 'no_leidas'"
                 [class.dark:text-gray-400]="filtroActivo !== 'no_leidas'">
            <span class="truncate text-sm font-medium leading-normal">No leídas</span>
            <input (change)="cambiarFiltro('no_leidas')"
                   [checked]="filtroActivo === 'no_leidas'"
                   class="invisible w-0"
                   name="notification_filter"
                   type="radio"
                   value="no_leidas"/>
          </label>
          <label class="flex cursor-pointer h-full grow items-center justify-center overflow-hidden rounded-lg px-2 transition-all"
                 [class.bg-white]="filtroActivo === 'leidas'"
                 [class.dark:bg-gray-900]="filtroActivo === 'leidas'"
                 [class.shadow-md]="filtroActivo === 'leidas'"
                 [class.text-primary]="filtroActivo === 'leidas'"
                 [class.text-gray-600]="filtroActivo !== 'leidas'"
                 [class.dark:text-gray-400]="filtroActivo !== 'leidas'">
            <span class="truncate text-sm font-medium leading-normal">Leídas</span>
            <input (change)="cambiarFiltro('leidas')"
                   [checked]="filtroActivo === 'leidas'"
                   class="invisible w-0"
                   name="notification_filter"
                   type="radio"
                   value="leidas"/>
          </label>
        </div>
      </div>

      <!-- Notifications List -->
      <div class="flex flex-col gap-2 mt-4">
        <div *ngFor="let notif of notificacionesFiltradas"
             class="flex gap-4 px-4 py-3 justify-between items-center rounded-lg group relative"
             [class.bg-white]="!notif.leida"
             [class.dark:bg-gray-800/50]="!notif.leida"
             [class.border-l-4]="!notif.leida"
             [class.border-primary]="!notif.leida"
             [class.bg-gray-50]="notif.leida"
             [class.dark:bg-gray-900]="notif.leida"
             [class.border-l-4]="notif.leida"
             [class.border-transparent]="notif.leida">
          
          <div class="flex items-start gap-4 flex-1">
            <div class="flex items-center justify-center rounded-lg shrink-0 size-12"
                 [class.bg-primary/20]="!notif.leida"
                 [class.text-gray-900]="!notif.leida"
                 [class.dark:text-white]="!notif.leida"
                 [class.bg-gray-200]="notif.leida"
                 [class.dark:bg-gray-700]="notif.leida"
                 [class.text-gray-600]="notif.leida"
                 [class.dark:text-gray-400]="notif.leida">
              <span class="material-symbols-outlined">{{ notif.icono }}</span>
            </div>
            <div class="flex flex-1 flex-col justify-center">
              <p class="text-base leading-normal text-gray-900 dark:text-white"
                 [class.font-bold]="!notif.leida"
                 [class.font-medium]="notif.leida">
                {{ notif.titulo }}
              </p>
              <p class="text-sm font-normal leading-normal text-gray-600 dark:text-gray-400">
                {{ notif.mensaje }}
              </p>
              <p class="text-xs font-normal leading-normal mt-1 text-gray-600 dark:text-gray-400">
                {{ obtenerTiempoTranscurrido(notif.fecha) }}
              </p>
            </div>
          </div>

          <div class="flex items-center gap-2">
            <button *ngIf="notif.cita_id"
                    (click)="verCita(notif)"
                    class="text-primary text-sm font-medium leading-normal hover:underline">
              Ver cita
            </button>
            <div class="absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
              <!-- Marcar como leída/no leída -->
              <button *ngIf="!notif.leida"
                      (click)="marcarComoLeida(notif.id)"
                      class="p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400"
                      title="Marcar como leída">
                <span class="material-symbols-outlined text-base">drafts</span>
              </button>
              <button *ngIf="notif.leida"
                      (click)="marcarComoNoLeida(notif.id)"
                      class="p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400"
                      title="Marcar como no leída">
                <span class="material-symbols-outlined text-base">mark_email_unread</span>
              </button>
              <!-- Eliminar -->
              <button (click)="eliminarNotificacion(notif.id)"
                      class="p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400"
                      title="Eliminar notificación">
                <span class="material-symbols-outlined text-base">delete</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="!hayNotificaciones" 
             class="flex flex-col items-center justify-center text-center p-16 bg-gray-100 dark:bg-gray-800/30 rounded-lg mt-8">
          <span class="material-symbols-outlined text-6xl text-gray-400 dark:text-gray-500">notifications_off</span>
          <h3 class="mt-4 text-xl font-semibold text-gray-900 dark:text-white">¡Todo al día!</h3>
          <p class="mt-1 text-gray-600 dark:text-gray-400">
            {{ filtroActivo === 'todas' ? 'No tienes notificaciones.' : 
               filtroActivo === 'no_leidas' ? 'No tienes notificaciones sin leer.' : 
               'No tienes notificaciones leídas.' }}
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
