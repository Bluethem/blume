<div class="w-full max-w-7xl mx-auto">
  <!-- Header -->
  <header class="mb-6">
    <h1 class="text-4xl font-black leading-tight tracking-tight text-gray-900 dark:text-white">
      Gestión de Administradores
    </h1>
  </header>

  <!-- Search and Add -->
  <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
    <div class="flex flex-col md:flex-row justify-between gap-4">
      <!-- Search -->
      <div class="flex-1">
        <div class="relative">
          <span class="material-symbols-outlined absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
            search
          </span>
          <input (input)="onSearch($event)"
                 [value]="searchTerm"
                 class="w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary/50 focus:border-primary"
                 placeholder="Buscar por nombre, email..."
                 type="text"/>
        </div>
      </div>

      <!-- Add Button -->
      <div class="flex items-center justify-end">
        <button (click)="openCreateModal()"
                class="flex items-center justify-center gap-2 rounded-lg h-12 bg-primary text-white px-5 text-sm font-bold hover:bg-red-700 transition-colors">
          <span class="material-symbols-outlined text-base">add</span>
          <span class="truncate">Agregar Administrador</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Bulk Actions Bar -->
  <div *ngIf="selectedIds.size > 0" 
       class="my-4 p-3 bg-primary/10 dark:bg-primary/20 rounded-lg flex items-center justify-between">
    <p class="text-sm font-semibold text-primary">{{ selectedIds.size }} administrador(es) seleccionado(s)</p>
    <div class="flex gap-2">
      <button (click)="bulkActivate()"
              class="flex items-center gap-2 px-3 py-1.5 text-xs font-bold text-green-700 dark:text-green-300 bg-green-500/10 rounded-md hover:bg-green-500/20 transition-colors">
        <span class="material-symbols-outlined text-sm">check_circle</span> Activar
      </button>
      <button (click)="bulkDeactivate()"
              class="flex items-center gap-2 px-3 py-1.5 text-xs font-bold text-gray-700 dark:text-gray-300 bg-gray-500/10 rounded-md hover:bg-gray-500/20 transition-colors">
        <span class="material-symbols-outlined text-sm">pause_circle</span> Desactivar
      </button>
      <button (click)="bulkDelete()"
              class="flex items-center gap-2 px-3 py-1.5 text-xs font-bold text-red-700 dark:text-red-300 bg-red-500/10 rounded-md hover:bg-red-500/20 transition-colors">
        <span class="material-symbols-outlined text-sm">delete</span> Eliminar
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex justify-center items-center py-20">
    <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-primary"></div>
  </div>

  <!-- Table -->
  <div *ngIf="!loading" class="mt-4 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full text-sm text-left">
        <thead class="bg-gray-50 dark:bg-gray-900 text-xs uppercase text-gray-600 dark:text-gray-400">
          <tr>
            <th class="p-4" scope="col">
              <input (change)="toggleSelectAll()"
                     [checked]="selectAll"
                     class="form-checkbox h-4 w-4 rounded text-primary bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 focus:ring-primary/50"
                     type="checkbox"/>
            </th>
            <th class="px-6 py-3" scope="col">Nombre Completo</th>
            <th class="px-6 py-3" scope="col">Email</th>
            <th class="px-6 py-3" scope="col">Rol</th>
            <th class="px-6 py-3" scope="col">Fecha de Creación</th>
            <th class="px-6 py-3" scope="col">Último Acceso</th>
            <th class="px-6 py-3" scope="col">Estado</th>
            <th class="px-6 py-3 text-center" scope="col">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let admin of administradores"
              class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-900 transition-colors">
            <td class="p-4">
              <input (change)="toggleSelect(admin.id)"
                     [checked]="selectedIds.has(admin.id)"
                     [disabled]="!isAdminSelectable(admin)"
                     class="form-checkbox h-4 w-4 rounded text-primary bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 focus:ring-primary/50"
                     [class.cursor-not-allowed]="!isAdminSelectable(admin)"
                     [class.opacity-50]="!isAdminSelectable(admin)"
                     type="checkbox"/>
            </td>
            
            <td class="px-6 py-4 font-medium whitespace-nowrap">
              <div class="flex items-center gap-3">
                <div *ngIf="admin.foto_url; else avatarPlaceholder" 
                     class="w-10 h-10 rounded-full bg-cover bg-center"
                     [style.background-image]="'url(' + admin.foto_url + ')'"></div>
                <ng-template #avatarPlaceholder>
                  <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center">
                    <span class="text-sm font-semibold text-primary">
                      {{ admin.nombre.charAt(0) }}{{ admin.apellido.charAt(0) }}
                    </span>
                  </div>
                </ng-template>
                <span class="text-gray-900 dark:text-white">{{ admin.nombre_completo }}</span>
              </div>
            </td>
            
            <td class="px-6 py-4 text-gray-600 dark:text-gray-400">
              {{ admin.email }}
            </td>
            
            <td class="px-6 py-4">
              <div *ngIf="admin.es_super_admin" class="flex items-center gap-2 text-primary font-bold">
                <span class="material-symbols-outlined text-lg">verified_user</span>
                <span class="text-sm">Super Admin</span>
              </div>
              <div *ngIf="!admin.es_super_admin" class="flex items-center gap-2 text-blue-600 dark:text-blue-400 font-medium">
                <span class="material-symbols-outlined text-lg">admin_panel_settings</span>
                <span class="text-sm">Administrador</span>
              </div>
            </td>
            
            <td class="px-6 py-4 text-gray-600 dark:text-gray-400">
              {{ admin.created_at | date:'dd/MM/yyyy' }}
            </td>
            
            <td class="px-6 py-4 text-gray-600 dark:text-gray-400">
              <span *ngIf="admin.ultimo_acceso">{{ admin.ultimo_acceso | date:'short' }}</span>
              <span *ngIf="!admin.ultimo_acceso" class="text-gray-400 dark:text-gray-500">Nunca</span>
            </td>
            
            <td class="px-6 py-4">
              <label class="relative inline-flex items-center"
                     [class.cursor-pointer]="admin.puede_desactivar"
                     [class.cursor-not-allowed]="!admin.puede_desactivar"
                     [class.opacity-50]="!admin.puede_desactivar">
                <input (change)="toggleEstado(admin)"
                       [checked]="admin.activo"
                       [disabled]="!admin.puede_desactivar"
                       class="sr-only peer"
                       type="checkbox"/>
                <div class="w-11 h-6 bg-gray-200 dark:bg-gray-700 rounded-full peer peer-focus:ring-2 peer-focus:ring-primary/50 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
              </label>
            </td>
            
            <td class="px-6 py-4">
              <div class="flex justify-center items-center gap-2">
                <button (click)="verAdmin(admin.id)"
                        class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                        title="Ver detalles">
                  <span class="material-symbols-outlined text-xl text-gray-600 dark:text-gray-400">visibility</span>
                </button>
                <button (click)="openEditModal(admin)"
                        [disabled]="!admin.puede_editar"
                        class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                        [class.cursor-not-allowed]="!admin.puede_editar"
                        [class.opacity-50]="!admin.puede_editar"
                        title="Editar">
                  <span class="material-symbols-outlined text-xl text-gray-600 dark:text-gray-400">edit</span>
                </button>
                <button (click)="confirmDelete(admin.id)"
                        [disabled]="!admin.puede_eliminar"
                        class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                        [class.cursor-not-allowed]="!admin.puede_eliminar"
                        [class.opacity-50]="!admin.puede_eliminar"
                        [class.text-primary]="admin.puede_eliminar"
                        title="Eliminar">
                  <span class="material-symbols-outlined text-xl">delete</span>
                </button>
              </div>
            </td>
          </tr>

          <!-- Empty State -->
          <tr *ngIf="administradores.length === 0">
            <td colspan="8" class="px-6 py-12 text-center">
              <div class="flex flex-col items-center">
                <span class="material-symbols-outlined text-6xl text-gray-400 mb-4">admin_panel_settings</span>
                <p class="text-gray-600 dark:text-gray-400">No se encontraron administradores</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <nav *ngIf="administradores.length > 0" 
         class="flex items-center justify-between p-4 border-t border-gray-200 dark:border-gray-700">
      <span class="text-sm font-normal text-gray-600 dark:text-gray-400">
        Mostrando 
        <span class="font-semibold text-gray-900 dark:text-white">{{ (currentPage - 1) * perPage + 1 }}-{{ Math.min(currentPage * perPage, totalCount) }}</span>
        de 
        <span class="font-semibold text-gray-900 dark:text-white">{{ totalCount }}</span>
      </span>

      <ul class="inline-flex -space-x-px text-sm h-8">
        <li>
          <button (click)="previousPage()"
                  [disabled]="currentPage === 1"
                  class="flex items-center justify-center px-3 h-8 ml-0 leading-tight text-gray-600 dark:text-gray-400 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-l-lg hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed">
            Anterior
          </button>
        </li>

        <li *ngFor="let page of getDisplayPages()">
          <button *ngIf="page > 0"
                  (click)="goToPage(page)"
                  [class.text-primary]="page === currentPage"
                  [class.bg-primary/20]="page === currentPage"
                  [class.border-primary/20]="page === currentPage"
                  [class.text-gray-600]="page !== currentPage"
                  [class.dark:text-gray-400]="page !== currentPage"
                  [class.bg-white]="page !== currentPage"
                  [class.dark:bg-gray-800]="page !== currentPage"
                  [class.border-gray-300]="page !== currentPage"
                  [class.dark:border-gray-600]="page !== currentPage"
                  class="flex items-center justify-center px-3 h-8 leading-tight border hover:bg-gray-100 dark:hover:bg-gray-700">
            {{ page }}
          </button>
          <span *ngIf="page === -1" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-600 dark:text-gray-400 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600">...</span>
        </li>

        <li>
          <button (click)="nextPage()"
                  [disabled]="currentPage === totalPages"
                  class="flex items-center justify-center px-3 h-8 leading-tight text-gray-600 dark:text-gray-400 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-r-lg hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed">
            Siguiente
          </button>
        </li>
      </ul>
    </nav>
  </div>
</div>

<!-- Modal Crear/Editar -->
<div *ngIf="showModal" 
     class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"
     (click)="closeModal()">
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl transform transition-all"
       (click)="$event.stopPropagation()">
    <div class="p-6">
      <div class="flex items-start justify-between mb-4">
        <h3 class="text-xl font-bold text-gray-900 dark:text-white">
          {{ editingAdmin ? 'Editar Administrador' : 'Nuevo Administrador' }}
        </h3>
        <button (click)="closeModal()"
                class="p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600">
          <span class="material-symbols-outlined text-gray-600 dark:text-gray-400">close</span>
        </button>
      </div>

      <!-- Errores -->
      <div *ngIf="formErrors.length > 0" class="mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
        <ul class="list-disc list-inside text-sm text-red-600 dark:text-red-400">
          <li *ngFor="let error of formErrors">{{ error }}</li>
        </ul>
      </div>

      <form class="space-y-4" (submit)="$event.preventDefault(); saveAdministrador()">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Nombre -->
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
              Nombre <span class="text-red-500">*</span>
            </label>
            <input [(ngModel)]="formData.nombre"
                   name="nombre"
                   class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-primary/50 focus:border-primary"
                   type="text"
                   required/>
          </div>

          <!-- Apellido -->
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
              Apellido <span class="text-red-500">*</span>
            </label>
            <input [(ngModel)]="formData.apellido"
                   name="apellido"
                   class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-primary/50 focus:border-primary"
                   type="text"
                   required/>
          </div>

          <!-- Email -->
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
              Email <span class="text-red-500">*</span>
            </label>
            <input [(ngModel)]="formData.email"
                   name="email"
                   class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-primary/50 focus:border-primary"
                   type="email"
                   required/>
          </div>

          <!-- Teléfono -->
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
              Teléfono
            </label>
            <input [(ngModel)]="formData.telefono"
                   name="telefono"
                   class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-primary/50 focus:border-primary"
                   type="tel"/>
          </div>

          <!-- Dirección -->
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
              Dirección
            </label>
            <input [(ngModel)]="formData.direccion"
                   name="direccion"
                   class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-primary/50 focus:border-primary"
                   type="text"/>
          </div>

          <!-- Password -->
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
              Contraseña {{ editingAdmin ? '' : '*' }}
            </label>
            <input [(ngModel)]="formData.password"
                   name="password"
                   class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-primary/50 focus:border-primary"
                   type="password"
                   [required]="!editingAdmin"
                   placeholder="{{ editingAdmin ? 'Dejar en blanco para no cambiar' : '' }}"/>
          </div>

          <!-- Password Confirmation -->
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
              Confirmar Contraseña {{ editingAdmin ? '' : '*' }}
            </label>
            <input [(ngModel)]="formData.password_confirmation"
                   name="password_confirmation"
                   class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-primary/50 focus:border-primary"
                   type="password"
                   [required]="!editingAdmin"/>
          </div>

          <!-- Estado -->
          <div class="md:col-span-2">
            <label class="flex items-center gap-2 cursor-pointer">
              <input [(ngModel)]="formData.activo"
                     name="activo"
                     class="form-checkbox h-4 w-4 rounded text-primary bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 focus:ring-primary/50"
                     type="checkbox"/>
              <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Cuenta activa</span>
            </label>
          </div>
        </div>
      </form>
    </div>

    <div class="bg-gray-50 dark:bg-gray-900/50 px-6 py-4 flex justify-end gap-3 rounded-b-xl">
      <button (click)="closeModal()"
              class="px-4 py-2 rounded-lg border border-gray-400 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
        Cancelar
      </button>
      <button (click)="saveAdministrador()"
              [disabled]="submitting"
              class="px-6 py-2 rounded-lg bg-primary text-white hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
        {{ submitting ? 'Guardando...' : 'Guardar' }}
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteConfirm" 
     class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md">
    <div class="p-6 text-center">
      <div class="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100 dark:bg-red-900/20">
        <span class="material-symbols-outlined text-red-600 text-3xl">warning</span>
      </div>
      <h3 class="mt-5 text-xl font-semibold text-gray-900 dark:text-white">¿Eliminar administrador?</h3>
      <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
        Esta acción no se puede deshacer. El administrador será eliminado permanentemente.
      </p>
    </div>
    <div class="flex justify-center items-center gap-4 p-4 pb-6 bg-gray-50 dark:bg-gray-900/50 rounded-b-xl">
      <button (click)="cancelDelete()"
              class="w-full px-4 py-2 text-sm font-medium rounded-lg border border-gray-400 text-gray-700 dark:border-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
        Cancelar
      </button>
      <button (click)="deleteAdministrador()"
              class="w-full px-4 py-2 text-sm font-medium rounded-lg bg-red-600 text-white hover:bg-red-700 transition-colors">
        Sí, eliminar
      </button>
    </div>
  </div>
</div>
