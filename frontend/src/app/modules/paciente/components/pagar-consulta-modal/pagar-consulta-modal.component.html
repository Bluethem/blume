<!-- Header -->
<div class="flex items-center justify-between p-6 border-b border-border-light dark:border-border-dark bg-primary">
  <h2 class="text-xl font-bold text-white flex items-center gap-2">
    <span class="material-symbols-outlined text-2xl">credit_card</span>
    Pagar Consulta
  </h2>
  <button 
    type="button"
    (click)="activeModal.dismiss()"
    [disabled]="procesando"
    class="text-white hover:text-gray-200 transition-colors disabled:opacity-50"
  >
    <span class="material-symbols-outlined text-2xl">close</span>
  </button>
</div>

<!-- Body -->
<div class="p-6 max-h-[70vh] overflow-y-auto">
  <!-- Información de la cita -->
  <div class="card p-4 mb-6">
    <h3 class="text-sm font-semibold text-text-secondary-light dark:text-text-secondary-dark mb-3">
      Detalle de la Consulta
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <p class="text-xs text-text-secondary-light dark:text-text-secondary-dark mb-1">Médico</p>
        <p class="font-semibold">{{ cita.medico.nombre_profesional }}</p>
      </div>
      <div>
        <p class="text-xs text-text-secondary-light dark:text-text-secondary-dark mb-1">Especialidad</p>
        <p class="font-medium">{{ cita.medico.especialidad_principal?.nombre || 'General' }}</p>
      </div>
      <div>
        <p class="text-xs text-text-secondary-light dark:text-text-secondary-dark mb-1">Fecha</p>
        <p class="font-medium">{{ cita.fecha_hora_inicio | date:'dd/MM/yyyy HH:mm' }}</p>
      </div>
      <div>
        <p class="text-xs text-text-secondary-light dark:text-text-secondary-dark mb-1">Monto</p>
        <p class="text-2xl font-bold text-success">S/ {{ costoNumerico | number:'1.2-2' }}</p>
      </div>
    </div>
  </div>

  <!-- Selección de método de pago -->
  <div class="mb-6">
    <label class="block text-sm font-bold mb-4 text-text-primary-light dark:text-text-primary-dark">
      Seleccione método de pago
    </label>
    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
      <button
        *ngFor="let metodo of metodosDisponibles"
        type="button"
        (click)="seleccionarMetodo(metodo)"
        [disabled]="procesando"
        [class.ring-2]="metodoSeleccionado === metodo"
        [class.ring-primary]="metodoSeleccionado === metodo"
        [class.bg-primary/5]="metodoSeleccionado === metodo"
        class="card p-4 hover:shadow-card-hover hover:border-primary transition-all cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed flex flex-col items-center gap-2"
      >
        <span 
          class="material-symbols-outlined text-4xl"
          [class.text-primary]="metodoSeleccionado === metodo"
          [class.text-text-secondary-light]="metodoSeleccionado !== metodo"
        >
          {{ getIconoMetodo(metodo) }}
        </span>
        <span 
          class="text-sm font-medium text-center"
          [class.text-primary]="metodoSeleccionado === metodo"
          [class.font-bold]="metodoSeleccionado === metodo"
        >
          {{ getLabelMetodo(metodo) }}
        </span>
      </button>
    </div>
  </div>

  <!-- Instrucciones según método -->
  <div 
    *ngIf="metodoSeleccionado" 
    class="p-4 rounded-lg mb-6"
    [ngClass]="{
      'bg-blue-50 dark:bg-blue-900/20': metodoSeleccionado === 'tarjeta',
      'bg-purple-50 dark:bg-purple-900/20': metodoSeleccionado === 'yape',
      'bg-pink-50 dark:bg-pink-900/20': metodoSeleccionado === 'plin',
      'bg-green-50 dark:bg-green-900/20': metodoSeleccionado === 'efectivo',
      'bg-indigo-50 dark:bg-indigo-900/20': metodoSeleccionado === 'transferencia'
    }"
  >
    <div class="flex items-start gap-3">
      <span class="material-symbols-outlined text-primary text-xl mt-0.5">info</span>
      <div class="flex-1">
        <p class="text-sm font-semibold mb-1">{{ getTituloInstrucciones() }}</p>
        <p class="text-sm text-text-secondary-light dark:text-text-secondary-dark">
          {{ getInstrucciones() }}
        </p>
      </div>
    </div>
  </div>

  <!-- Advertencia -->
  <div *ngIf="!metodoSeleccionado" class="flex items-center gap-2 p-4 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-300">
    <span class="material-symbols-outlined text-xl">warning</span>
    <p class="text-sm">Por favor, seleccione un método de pago para continuar</p>
  </div>
</div>

<!-- Footer -->
<div class="flex items-center justify-end gap-3 p-6 border-t border-border-light dark:border-border-dark bg-gray-50 dark:bg-gray-900">
  <button
    type="button"
    (click)="activeModal.dismiss()"
    [disabled]="procesando"
    class="px-4 py-2 text-sm font-medium text-text-secondary-light dark:text-text-secondary-dark hover:text-text-primary-light dark:hover:text-text-primary-dark transition-colors disabled:opacity-50"
  >
    Cancelar
  </button>
  <button
    type="button"
    (click)="procesarPago()"
    [disabled]="!metodoSeleccionado || procesando"
    class="px-6 py-2 text-sm font-bold text-white bg-primary hover:bg-primary-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
  >
    <span *ngIf="procesando" class="animate-spin material-symbols-outlined text-base">refresh</span>
    <span class="material-symbols-outlined text-base" *ngIf="!procesando">{{ getIconoBotonPagar() }}</span>
    {{ getTextBotonPagar() }}
  </button>
</div>
