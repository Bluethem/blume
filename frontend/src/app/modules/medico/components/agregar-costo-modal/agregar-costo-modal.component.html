<!-- Header -->
<div class="flex items-center justify-between p-6 border-b border-border-light dark:border-border-dark bg-primary">
  <h2 class="text-xl font-bold text-white flex items-center gap-2">
    <span class="material-symbols-outlined text-2xl">add_circle</span>
    Agregar Cargo Adicional
  </h2>
  <button 
    type="button"
    (click)="activeModal.dismiss()"
    [disabled]="procesando"
    class="text-white hover:text-gray-200 transition-colors disabled:opacity-50"
  >
    <span class="material-symbols-outlined text-2xl">close</span>
  </button>
</div>

<!-- Body -->
<div class="p-6">
  <!-- Información de la cita -->
  <div class="card p-4 mb-6 bg-blue-50 dark:bg-blue-900/20">
    <div class="flex items-start gap-3">
      <span class="material-symbols-outlined text-primary text-xl">info</span>
      <div class="flex-1">
        <p class="font-semibold mb-1">{{ cita.paciente?.nombre_completo || 'Paciente' }}</p>
        <p class="text-sm text-gray-600 dark:text-gray-400">
          Consulta del {{ cita.fecha_hora_inicio | date:'dd/MM/yyyy HH:mm' }}
        </p>
        <p class="text-sm text-gray-600 dark:text-gray-400">
          Costo original: <span class="font-semibold text-green-600">S/ {{ cita.costo | number:'1.2-2' }}</span>
        </p>
      </div>
    </div>
  </div>

  <!-- Formulario -->
  <form (ngSubmit)="agregar()" class="space-y-6">
    
    <!-- Concepto predefinido -->
    <div>
      <label class="block text-sm font-bold mb-3">
        Concepto del Cargo
      </label>
      <div class="grid grid-cols-2 gap-2">
        <button
          *ngFor="let concepto of conceptosPredefinidos"
          type="button"
          (click)="seleccionarConcepto(concepto)"
          [class.ring-2]="this.concepto === concepto || (concepto === 'Otro' && !conceptosPredefinidos.slice(0, -1).includes(this.concepto))"
          [class.ring-primary]="this.concepto === concepto || (concepto === 'Otro' && !conceptosPredefinidos.slice(0, -1).includes(this.concepto))"
          [class.bg-primary/5]="this.concepto === concepto || (concepto === 'Otro' && !conceptosPredefinidos.slice(0, -1).includes(this.concepto))"
          class="text-left p-3 rounded-lg border border-border-light dark:border-border-dark hover:border-primary transition-all text-sm"
        >
          {{ concepto }}
        </button>
      </div>
    </div>

    <!-- Concepto personalizado -->
    <div *ngIf="!conceptosPredefinidos.slice(0, -1).includes(concepto)">
      <label class="block text-sm font-bold mb-2">
        Especifique el concepto
      </label>
      <input
        type="text"
        [(ngModel)]="concepto"
        name="concepto"
        [disabled]="procesando"
        placeholder="Ej: Extracción de muela"
        class="w-full px-4 py-2 rounded-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50"
        required
      />
    </div>

    <!-- Monto -->
    <div>
      <label class="block text-sm font-bold mb-2">
        Monto del Cargo (S/)
      </label>
      <div class="relative">
        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 font-bold">
          S/
        </span>
        <input
          type="number"
          [(ngModel)]="monto"
          name="monto"
          [disabled]="procesando"
          placeholder="0.00"
          step="0.01"
          min="0.01"
          class="w-full pl-12 pr-4 py-3 rounded-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark focus:outline-none focus:ring-2 focus:ring-primary text-lg font-semibold disabled:opacity-50"
          required
        />
      </div>
      <p class="text-xs text-gray-500 mt-2">
        El paciente deberá pagar este monto adicional para completar su consulta.
      </p>
    </div>

    <!-- Resumen -->
    <div *ngIf="montoValido" class="card p-4 bg-green-50 dark:bg-green-900/20">
      <div class="flex justify-between items-center">
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400">Costo original</p>
          <p class="font-semibold">S/ {{ cita.costo | number:'1.2-2' }}</p>
        </div>
        <span class="material-symbols-outlined text-gray-400">add</span>
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400">Cargo adicional</p>
          <p class="font-semibold text-warning">S/ {{ monto | number:'1.2-2' }}</p>
        </div>
        <span class="material-symbols-outlined text-gray-400">equals</span>
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400">Total</p>
          <p class="text-xl font-bold text-success">S/ {{ (cita.costo + monto) | number:'1.2-2' }}</p>
        </div>
      </div>
    </div>

  </form>
</div>

<!-- Footer -->
<div class="flex items-center justify-end gap-3 p-6 border-t border-border-light dark:border-border-dark bg-gray-50 dark:bg-gray-900">
  <button
    type="button"
    (click)="activeModal.dismiss()"
    [disabled]="procesando"
    class="px-4 py-2 text-sm font-medium text-text-secondary-light dark:text-text-secondary-dark hover:text-text-primary-light dark:hover:text-text-primary-dark transition-colors disabled:opacity-50"
  >
    Cancelar
  </button>
  <button
    type="button"
    (click)="agregar()"
    [disabled]="!formularioValido"
    class="px-6 py-2 text-sm font-bold text-white bg-primary hover:bg-primary-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
  >
    <span class="material-symbols-outlined text-base">add_circle</span>
    Agregar Cargo
  </button>
</div>
